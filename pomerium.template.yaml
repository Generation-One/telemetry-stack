# Pomerium configuration for telemetry-stack
# Authentication via Google OAuth

# Identity Provider settings - Google
authenticate_service_url: https://${POMERIUM_AUTHENTICATE_DOMAIN}

# Google OAuth credentials (from environment variables)
# Create at: https://console.cloud.google.com/apis/credentials
# Redirect URI: https://${POMERIUM_AUTHENTICATE_DOMAIN:-authenticate.localhost}/oauth2/callback
# JavaScript origin: https://${POMERIUM_AUTHENTICATE_DOMAIN:-authenticate.localhost}
idp_provider: ${IDP_PROVIDER}
idp_client_id: ${IDP_CLIENT_ID}
idp_client_secret: ${IDP_CLIENT_SECRET}

# Security secrets (from environment variables)
cookie_secret: ${COOKIE_SECRET}
signing_key: ${SIGNING_KEY}

# Address configuration
address: :443
http_redirect_addr: :80

# Routes configuration (host-based)
routes:
  # Grafana - access via https://${GRAFANA_DOMAIN}
  - from: https://${GRAFANA_DOMAIN}
    to: http://grafana:3000
    pass_identity_headers: true
    allow_any_authenticated_user: true

  # Jaeger - access via https://${JAEGER_DOMAIN}
  - from: https://${JAEGER_DOMAIN}
    to: http://jaeger:16686
    pass_identity_headers: true
    allow_any_authenticated_user: true

  # Seq - access via https://${SEQ_DOMAIN}
  - from: https://${SEQ_DOMAIN}
    to: http://seq:80
    pass_identity_headers: true
    allow_any_authenticated_user: true
    jwt_claims_headers:
      - email
      - name
    set_request_headers:
      X-Forwarded-Email: "${pomerium.jwt.claim.email}"
      X-Forwarded-User: "${pomerium.jwt.claim.email}"
      X-Forwarded-Name: "${pomerium.jwt.claim.name}"
